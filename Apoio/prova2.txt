; Configuração do ATmega328P
.include "m328Pdef.inc"

.org 0x00
    rjmp RESET        ; Vetor de reset

RESET:
    ldi r16, 0xFF    ; Configurar PORTB como saída (LEDs)
    out DDRB, r16

    ldi r16, 0x00    ; Configurar PORTD como entrada (botões)
    out DDRD, r16

    ldi r16, (1<<PD2) | (1<<PD3) ; Habilitar pull-up interno para botões
    out PORTD, r16

    ldi r17, 0x01   ; Inicializar LED na primeira posição
    ldi r18, 1      ; Direção (1 = direita, -1 = esquerda)

MAIN_LOOP:
    out PORTB, r17  ; Atualizar LEDs
    call DELAY_200ms

    in r19, PIND    ; Ler estado dos botões
    sbrs r19, PD2   ; Se botão - pressionado
    ldi r18, -1     ; Muda direção para esquerda
    sbrs r19, PD3   ; Se botão + pressionado
    ldi r18, 1      ; Muda direção para direita

    tst r18         ; Verificar direção
    brmi LEFT_SHIFT ; Se negativo, deslocar para esquerda

    lsl r17         ; Caso contrário, deslocar para a direita
    cpi r17, 0x00   ; Se atingir limite, reinicia
    breq RESET_LED  
    rjmp MAIN_LOOP

LEFT_SHIFT:
    lsr r17         ; Desloca para esquerda
    cpi r17, 0x00   ; Se atingir limite, reinicia
    breq RESET_LED  
    rjmp MAIN_LOOP

RESET_LED:
    ldi r17, 0x01   ; Reinicia LED
    rjmp MAIN_LOOP

; Rotina de Delay de 200ms
DELAY_200ms:
    ldi r20, 50     ; Ajuste baseado no clock do microcontrolador
LOOP1:
    ldi r21, 255
LOOP2:
    dec r21
    brne LOOP2
    dec r20
    brne LOOP1
    ret
